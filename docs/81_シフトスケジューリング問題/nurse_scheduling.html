<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>nurse_scheduling.py</marimo-filename>
    <title>nurse scheduling</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/assets/index-DlQKt39j.js"></script>
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.14.7/dist/assets/index-7fo-bO1b.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
</head>
  <body>
    <div id="root"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "nurse_scheduling.py",
            "mode": "read",
            "version": "0.14.7",
            "serverToken": "static",
            "config": {"completion": {"activate_on_typing": true, "copilot": false}, "display": {"cell_output": "above", "code_editor_font_size": 16, "dataframes": "rich", "default_table_page_size": 10, "default_width": "medium", "theme": "system"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": true}}, "package_management": {"manager": "uv"}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "import marimo as mo", "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hbol", "name": "_"}, {"code": "from ortools.sat.python import cp_model", "code_hash": "ed9fd4553ba56933d104de39c3acfd1b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "MJUe", "name": "_"}, {"code": "mo.md(r\"\"\"# \u770b\u8b77\u5e2b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u554f\u984c\"\"\")", "code_hash": "ca314b45ffbc3afd68ff1e52c4a009f3", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "vblA", "name": "_"}, {"code": "mo.md(r\"\"\"## \u554f\u984c\u8a2d\u5b9a\"\"\")", "code_hash": "586772ba4d73d385db8b98b9766d5064", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "bkHC", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n\u5178\u578b\u7684\u306a\u8a2d\u5b9a\u3060\u3068\u4e0b\u8a18. \n\n- \u6bce\u65e5\u306e\u5404\u52e4\u52d9 (\u663c, \u5915, \u591c) \u306e\u5fc5\u8981\u4eba\u6570\n- \u5404\u770b\u8b77\u5e2b\u306b\u5bfe\u3057\u3066 30 \u65e5\u9593\u306e\u52e4\u52d9\u65e5\u6570\u306e\u4e0a\u4e0b\u9650\n- \u6307\u5b9a\u4f11\u65e5, \u6307\u5b9a\u4f1a\u8b70\u65e5\n- \u9023\u7d9a 7 \u65e5\u9593\u306b\u6700\u4f4e 1 \u65e5\u306e\u4f11\u65e5, \u6700\u4f4e 1 \u65e5\u306e\u663c\u52e4\u52d9\n- \u7981\u6b62\u30d1\u30bf\u30fc\u30f3\n    - 3 \u9023\u7d9a\u591c\u52e4\n    - 4 \u9023\u7d9a\u5915\u52e4\n    - 5 \u9023\u7d9a\u663c\u52e4\n    - \u591c\u52e4\u660e\u3051\u306e\u4f11\u65e5\u4ee5\u5916\n    - \u5915\u52e4\u306e\u76f4\u5f8c\u306e\u663c\u52e4\u3042\u308b\u3044\u306f\u4f1a\u8b70\n    - \u4f11\u65e5 ::lucide:arrow-right:: \u52e4\u52d9 ::lucide:arrow-right:: \u4f11\u65e5\n- \u591c\u52e4\u306f 2 \u56de\u9023\u7d9a\u3067\u884c\u3046\n- 2 \u3064\u306e\u30c1\u30fc\u30e0\u306e\u4eba\u6570\u3092\u3067\u304d\u308b\u3060\u3051\u5747\u7b49\u5316\n\"\"\"\n)", "code_hash": "2749bff679d8964652846f99874a5da0", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "lEQa", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\n### \u5b9a\u6570\n\n- $W$: \u4f11\u65e5\u4ee5\u5916\u306e\u30b7\u30d5\u30c8\u306e\u96c6\u5408\n- $N$: \u591c\u52e4\u4ee5\u5916\u306e\u30b7\u30d5\u30c8\u306e\u96c6\u5408\n- $L_{d s}$: \u65e5 $d$ \u306e\u30b7\u30d5\u30c8 $s$ \u306e\u5fc5\u8981\u4eba\u6570\n- $\\mathrm{LB}, \\mathrm{UB}$: \u5404\u770b\u8b77\u5e2b\u306e 30 \u65e5\u9593\u306e\u52e4\u52d9\u65e5\u6570\u306e\u4e0a\u4e0b\u9650\n- $R_i$: \u770b\u8b77\u5e2b $i$ \u304c\u4f11\u65e5\u3092\u5e0c\u671b\u3059\u308b\u65e5\u306e\u96c6\u5408\n- $T_1, T_2$: \u30c1\u30fc\u30e0 1, \u30c1\u30fc\u30e0 2.\n\n### \u6c7a\u5b9a\u5909\u6570\n\n- $x_{i d s}$: \u770b\u8b77\u5e2b $i$ \u306e $d$ \u65e5\u306e\u52e4\u52d9\u304c $s$ \u3067\u3042\u308b\u3068\u304d $1$. \u305d\u3046\u3067\u306a\u3044\u3068\u304d $0$\n\n### \u5236\u7d04\u6761\u4ef6\n\n- \u6bce\u65e5\u306e\u5404\u52e4\u52d9\u306e\u5fc5\u8981\u4eba\u6570: $\\sum_{i} x_{i d s} \\geq L_{d s}$ $(\\forall d, s)$\n- \u5404\u770b\u8b77\u5e2b\u306e 30 \u65e5\u9593\u306e\u52e4\u52d9\u65e5\u6570\u306e\u4e0a\u4e0b\u9650: $\\mathrm{LB} \\leq \\sum_{d, s \\in W} x_{i d s} \\leq \\mathrm{UB}$ $(\\forall i)$\n- \u6307\u5b9a\u4f11\u65e5\u30fb\u6307\u5b9a\u4f1a\u8b70\u65e5: $\\sum_{d \\in R_i, s \\in W} x_{i d s} \\leq 0$ $(\\forall i)$\n- \u9023\u7d9a 7 \u65e5\u9593\u306b\u6700\u4f4e 1 \u65e5\u306e\u4f11\u65e5, \u6700\u4f4e 1 \u65e5\u306e\u663c\u52e4:\n    - $\\sum_{t = 0}^{6} x_{i, d+t, \\text{\u4f11}} \\geq 1$ $(\\forall i, d)$\n    - $\\sum_{t = 0}^{6} x_{i, d+t, \\text{\u663c}} \\geq 1$ $(\\forall i, d)$\n- \u7981\u6b62\u30d1\u30bf\u30fc\u30f3\n    - 3 \u9023\u7d9a\u591c\u52e4: $\\sum_{t = 0}^{2} x_{i, d+t, \\text{\u591c}} \\leq 2$ $(\\forall i, d)$\n    - 4 \u9023\u7d9a\u5915\u52e4: $\\sum_{t = 0}^{3} x_{i, d+t, \\text{\u5915}} \\leq 3$ $(\\forall i, d)$\n    - 5 \u9023\u7d9a\u663c\u52e4: $\\sum_{t = 0}^{4} x_{i, d+t, \\text{\u663c}} \\leq 4$ $(\\forall i, d)$\n    - \u591c\u52e4\u660e\u3051\u306e\u4f11\u65e5\u4ee5\u5916: $\\sum_{s \\in W \\cap N} x_{i, d + 1, s} <= 5 \\cdot (1 - x_{i, d, \\text{\u591c}})$\n    - \u5915\u306e\u76f4\u5f8c\u306e\u663c\u3042\u308b\u3044\u306f\u4f1a\u8b70: \u4f1a\u8b70\u304c\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u306e\u3067\u7701\u7565\n    - \u4f11\u65e5 ::lucide:arrow-right:: \u52e4\u52d9 ::lucide:arrow-right:: \u4f11\u65e5: $x_{i, d-1, \\text{\u4f11}} + \\sum_{s \\in W} x_{i d s} + x_{i, d+1, \\text{\u4f11}} \\leq 2$\n- \u591c\u52e4\u306f 2 \u9023\u7d9a: $\\sum_{s \\in N} x_{i,d-1,s} + x_{i,d,\\text{\u591c}} + \\sum_{s \\in N} x_{i,d+1,s} \\leq 2$\n- 2 \u30c1\u30fc\u30e0\u306e\u4eba\u6570\u3092\u3067\u304d\u308b\u3060\u3051\u5747\u7b49\u5316:\n  $\\sum_{i \\in T_1} x_{i d s} = \\sum_{i \\in T_2} x_{i d s}$ $(\\forall d, s)$. \u3053\u308c\u306f\u5236\u7d04\u3068\u3044\u3046\u3088\u308a\u306f\u76ee\u7684\u95a2\u6570?\n\"\"\"\n)", "code_hash": "e4cf441ca3f0998a90b364837ae1372c", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "PKri", "name": "_"}, {"code": "mo.md(r\"\"\"## OR-Tools Example\"\"\")", "code_hash": "2fe46d19ca3a8f4c7efe355b92124f2c", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Xref", "name": "_"}, {"code": "mo.md(\n    r\"\"\"\u53c2\u8003: https://github.com/google/or-tools/blob/stable/examples/notebook/sat/nurses_sat.ipynb\"\"\"\n)", "code_hash": "86530c6ada3b9f28d23cd3fd72eeba0d", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "SFPL", "name": "_"}, {"code": "class NursesPartialSolutionPrinter(cp_model.CpSolverSolutionCallback):\n    \"\"\"Print intermediate solutions.\"\"\"\n\n    def __init__(self, shifts, num_nurses, num_days, num_shifts, limit):\n        cp_model.CpSolverSolutionCallback.__init__(self)\n        self._shifts = shifts\n        self._num_nurses = num_nurses\n        self._num_days = num_days\n        self._num_shifts = num_shifts\n        self._solution_count = 0\n        self._solution_limit = limit\n\n    def on_solution_callback(self):\n        self._solution_count += 1\n        print(f\"Solution {self._solution_count}\")\n        for d in range(self._num_days):\n            print(f\"Day {d}\")\n            for n in range(self._num_nurses):\n                is_working = False\n                for s in range(self._num_shifts):\n                    if self.value(self._shifts[(n, d, s)]):\n                        is_working = True\n                        print(f\"  Nurse {n} works shift {s}\")\n                if not is_working:\n                    print(f\"  Nurse {n} does not work\")\n        if self._solution_count >= self._solution_limit:\n            print(f\"Stop search after {self._solution_limit} solutions\")\n            self.stop_search()\n\n    def solutionCount(self):\n        return self._solution_count", "code_hash": "1342640c9daa61fdce56e59385afd202", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "BYtC", "name": "_"}, {"code": "class Model:\n    def __init__(self, num_nurses: int, num_shifts: int, num_days: int):\n        all_nurses = range(num_nurses)\n        all_shifts = range(num_shifts)\n        all_days = range(num_days)\n\n        model = cp_model.CpModel()\n\n        # shifts[(n, d, s)]: nurse 'n' works shift 's' on day 'd'.\n        shifts = {\n            (_n, _d, _s): model.new_bool_var(f\"shift_n{_n}_d{_d}_s{_s}\")\n            for _n in all_nurses\n            for _d in all_days\n            for _s in all_shifts\n        }\n\n        # Each shift is assigned to exactly one nurse in the schedule period.\n        for _d in all_days:\n            for _s in all_shifts:\n                model.add_exactly_one(\n                    shifts[(_n, _d, _s)] for _n in all_nurses\n                )\n\n        # Each nurse works at most one shift per day.\n        for _n in all_nurses:\n            for _d in all_days:\n                model.add_at_most_one(\n                    shifts[(_n, _d, _s)] for _s in all_shifts\n                )\n\n        # Try to distribute the shifts evenly, so that each nurse works\n        # min_shifts_per_nurse shifts. If this is not possible, because the total\n        # number of shifts is not divisible by the number of nurses, some nurses will\n        # be assigned one more shift.\n        min_shifts_per_nurse = (num_shifts * num_days) // num_nurses\n        if num_shifts * num_days % num_nurses == 0:\n            max_shifts_per_nurse = min_shifts_per_nurse\n        else:\n            max_shifts_per_nurse = min_shifts_per_nurse + 1\n\n        for _n in all_nurses:\n            shifts_worked = []\n            for _d in all_days:\n                for _s in all_shifts:\n                    shifts_worked.append(shifts[(_n, _d, _s)])\n            model.add(min_shifts_per_nurse <= sum(shifts_worked))\n            model.add(sum(shifts_worked) <= max_shifts_per_nurse)\n\n        # \u8ffd\u52a0\n        # shift 0 \u3092\u591c\u52e4\u3068\u3057\u3066\n        # - \u591c\u52e4\u306f 2 \u9023\u7d9a\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\n        # - \u591c\u52e4\u306f 3 \u9023\u7d9a\u3057\u3066\u306f\u3044\u3051\u306a\u3044\n        # \u305f\u3060\u3053\u308c\u3060\u3068\u591c\u52e4\u304c\u504f\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u8ffd\u52a0\u306e\u5236\u7d04\u304c\u5fc5\u8981\n        for _n in all_nurses:\n            model.add_implication(shifts[(_n, 0, 0)], shifts[(_n, 1, 0)])\n            for _d in all_days:\n                if _d == 0 or _d == num_days - 1:\n                    continue\n                model.add_implication(\n                    shifts[(_n, _d, 0)], shifts[(_n, _d + 1, 0)]\n                ).only_enforce_if(~shifts[(_n, _d - 1, 0)])\n                model.add_bool_or(\n                    [~shifts[(_n, _d + _t, 0)] for _t in [-1, 0, 1]]\n                )\n\n        self.num_nurses = num_nurses\n        self.num_shifts = num_shifts\n        self.num_days = num_days\n        self.cpmodel = model\n        self.shifts = shifts\n\n    def solve(self):\n        solver = cp_model.CpSolver()\n        solver.parameters.linearization_level = 0\n        # Enumerate all solutions.\n        solver.parameters.enumerate_all_solutions = True\n\n        solution_limit = 5\n        solution_printer = NursesPartialSolutionPrinter(\n            self.shifts,\n            self.num_nurses,\n            self.num_days,\n            self.num_shifts,\n            solution_limit,\n        )\n\n        solver.solve(self.cpmodel, solution_printer)\n\n        # Statistics.\n        print(\"\\nStatistics\")\n        print(f\"  - conflicts      : {solver.num_conflicts}\")\n        print(f\"  - branches       : {solver.num_branches}\")\n        print(f\"  - wall time      : {solver.wall_time} s\")\n        print(f\"  - solutions found: {solution_printer.solutionCount()}\")", "code_hash": "ea87344604daeae899ffe0a9ce93ac65", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "RGSE", "name": "_"}, {"code": "model = Model(num_nurses=4, num_shifts=3, num_days=6)\nmodel.solve()", "code_hash": "5304ed72321b31dae0be83049cebbfa0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Kclp", "name": "_"}, {"code": "", "code_hash": null, "config": {"column": null, "disabled": false, "hide_code": false}, "id": "emfo", "name": "_"}], "metadata": {"marimo_version": "0.14.7"}, "version": "1"},
            "session": {"cells": [{"code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "console": [], "id": "Hbol", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "ed9fd4553ba56933d104de39c3acfd1b", "console": [], "id": "MJUe", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "ca314b45ffbc3afd68ff1e52c4a009f3", "console": [], "id": "vblA", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h1 id=\"_1\">\u770b\u8b77\u5e2b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u554f\u984c</h1></span>"}, "type": "data"}]}, {"code_hash": "586772ba4d73d385db8b98b9766d5064", "console": [], "id": "bkHC", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"_1\">\u554f\u984c\u8a2d\u5b9a</h2></span>"}, "type": "data"}]}, {"code_hash": "2749bff679d8964652846f99874a5da0", "console": [], "id": "lEQa", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><span class=\"paragraph\">\u5178\u578b\u7684\u306a\u8a2d\u5b9a\u3060\u3068\u4e0b\u8a18. </span>\n<ul>\n<li>\u6bce\u65e5\u306e\u5404\u52e4\u52d9 (\u663c, \u5915, \u591c) \u306e\u5fc5\u8981\u4eba\u6570</li>\n<li>\u5404\u770b\u8b77\u5e2b\u306b\u5bfe\u3057\u3066 30 \u65e5\u9593\u306e\u52e4\u52d9\u65e5\u6570\u306e\u4e0a\u4e0b\u9650</li>\n<li>\u6307\u5b9a\u4f11\u65e5, \u6307\u5b9a\u4f1a\u8b70\u65e5</li>\n<li>\u9023\u7d9a 7 \u65e5\u9593\u306b\u6700\u4f4e 1 \u65e5\u306e\u4f11\u65e5, \u6700\u4f4e 1 \u65e5\u306e\u663c\u52e4\u52d9</li>\n<li>\u7981\u6b62\u30d1\u30bf\u30fc\u30f3<ul>\n<li>3 \u9023\u7d9a\u591c\u52e4</li>\n<li>4 \u9023\u7d9a\u5915\u52e4</li>\n<li>5 \u9023\u7d9a\u663c\u52e4</li>\n<li>\u591c\u52e4\u660e\u3051\u306e\u4f11\u65e5\u4ee5\u5916</li>\n<li>\u5915\u52e4\u306e\u76f4\u5f8c\u306e\u663c\u52e4\u3042\u308b\u3044\u306f\u4f1a\u8b70</li>\n<li>\u4f11\u65e5 <iconify-icon icon=\"lucide:arrow-right\" inline=\"\"></iconify-icon> \u52e4\u52d9 <iconify-icon icon=\"lucide:arrow-right\" inline=\"\"></iconify-icon> \u4f11\u65e5</li>\n</ul>\n</li>\n<li>\u591c\u52e4\u306f 2 \u56de\u9023\u7d9a\u3067\u884c\u3046</li>\n<li>2 \u3064\u306e\u30c1\u30fc\u30e0\u306e\u4eba\u6570\u3092\u3067\u304d\u308b\u3060\u3051\u5747\u7b49\u5316</li>\n</ul></span>"}, "type": "data"}]}, {"code_hash": "e4cf441ca3f0998a90b364837ae1372c", "console": [], "id": "PKri", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h3 id=\"_1\">\u5b9a\u6570</h3>\n<ul>\n<li><marimo-tex class=\"arithmatex\">||(W||)</marimo-tex>: \u4f11\u65e5\u4ee5\u5916\u306e\u30b7\u30d5\u30c8\u306e\u96c6\u5408</li>\n<li><marimo-tex class=\"arithmatex\">||(N||)</marimo-tex>: \u591c\u52e4\u4ee5\u5916\u306e\u30b7\u30d5\u30c8\u306e\u96c6\u5408</li>\n<li><marimo-tex class=\"arithmatex\">||(L_{d s}||)</marimo-tex>: \u65e5 <marimo-tex class=\"arithmatex\">||(d||)</marimo-tex> \u306e\u30b7\u30d5\u30c8 <marimo-tex class=\"arithmatex\">||(s||)</marimo-tex> \u306e\u5fc5\u8981\u4eba\u6570</li>\n<li><marimo-tex class=\"arithmatex\">||(\\mathrm{LB}, \\mathrm{UB}||)</marimo-tex>: \u5404\u770b\u8b77\u5e2b\u306e 30 \u65e5\u9593\u306e\u52e4\u52d9\u65e5\u6570\u306e\u4e0a\u4e0b\u9650</li>\n<li><marimo-tex class=\"arithmatex\">||(R_i||)</marimo-tex>: \u770b\u8b77\u5e2b <marimo-tex class=\"arithmatex\">||(i||)</marimo-tex> \u304c\u4f11\u65e5\u3092\u5e0c\u671b\u3059\u308b\u65e5\u306e\u96c6\u5408</li>\n<li><marimo-tex class=\"arithmatex\">||(T_1, T_2||)</marimo-tex>: \u30c1\u30fc\u30e0 1, \u30c1\u30fc\u30e0 2.</li>\n</ul>\n<h3 id=\"_2\">\u6c7a\u5b9a\u5909\u6570</h3>\n<ul>\n<li><marimo-tex class=\"arithmatex\">||(x_{i d s}||)</marimo-tex>: \u770b\u8b77\u5e2b <marimo-tex class=\"arithmatex\">||(i||)</marimo-tex> \u306e <marimo-tex class=\"arithmatex\">||(d||)</marimo-tex> \u65e5\u306e\u52e4\u52d9\u304c <marimo-tex class=\"arithmatex\">||(s||)</marimo-tex> \u3067\u3042\u308b\u3068\u304d <marimo-tex class=\"arithmatex\">||(1||)</marimo-tex>. \u305d\u3046\u3067\u306a\u3044\u3068\u304d <marimo-tex class=\"arithmatex\">||(0||)</marimo-tex></li>\n</ul>\n<h3 id=\"_3\">\u5236\u7d04\u6761\u4ef6</h3>\n<ul>\n<li>\u6bce\u65e5\u306e\u5404\u52e4\u52d9\u306e\u5fc5\u8981\u4eba\u6570: <marimo-tex class=\"arithmatex\">||(\\sum_{i} x_{i d s} \\geq L_{d s}||)</marimo-tex> <marimo-tex class=\"arithmatex\">||((\\forall d, s)||)</marimo-tex></li>\n<li>\u5404\u770b\u8b77\u5e2b\u306e 30 \u65e5\u9593\u306e\u52e4\u52d9\u65e5\u6570\u306e\u4e0a\u4e0b\u9650: <marimo-tex class=\"arithmatex\">||(\\mathrm{LB} \\leq \\sum_{d, s \\in W} x_{i d s} \\leq \\mathrm{UB}||)</marimo-tex> <marimo-tex class=\"arithmatex\">||((\\forall i)||)</marimo-tex></li>\n<li>\u6307\u5b9a\u4f11\u65e5\u30fb\u6307\u5b9a\u4f1a\u8b70\u65e5: <marimo-tex class=\"arithmatex\">||(\\sum_{d \\in R_i, s \\in W} x_{i d s} \\leq 0||)</marimo-tex> <marimo-tex class=\"arithmatex\">||((\\forall i)||)</marimo-tex></li>\n<li>\u9023\u7d9a 7 \u65e5\u9593\u306b\u6700\u4f4e 1 \u65e5\u306e\u4f11\u65e5, \u6700\u4f4e 1 \u65e5\u306e\u663c\u52e4:<ul>\n<li><marimo-tex class=\"arithmatex\">||(\\sum_{t = 0}^{6} x_{i, d+t, \\text{\u4f11}} \\geq 1||)</marimo-tex> <marimo-tex class=\"arithmatex\">||((\\forall i, d)||)</marimo-tex></li>\n<li><marimo-tex class=\"arithmatex\">||(\\sum_{t = 0}^{6} x_{i, d+t, \\text{\u663c}} \\geq 1||)</marimo-tex> <marimo-tex class=\"arithmatex\">||((\\forall i, d)||)</marimo-tex></li>\n</ul>\n</li>\n<li>\u7981\u6b62\u30d1\u30bf\u30fc\u30f3<ul>\n<li>3 \u9023\u7d9a\u591c\u52e4: <marimo-tex class=\"arithmatex\">||(\\sum_{t = 0}^{2} x_{i, d+t, \\text{\u591c}} \\leq 2||)</marimo-tex> <marimo-tex class=\"arithmatex\">||((\\forall i, d)||)</marimo-tex></li>\n<li>4 \u9023\u7d9a\u5915\u52e4: <marimo-tex class=\"arithmatex\">||(\\sum_{t = 0}^{3} x_{i, d+t, \\text{\u5915}} \\leq 3||)</marimo-tex> <marimo-tex class=\"arithmatex\">||((\\forall i, d)||)</marimo-tex></li>\n<li>5 \u9023\u7d9a\u663c\u52e4: <marimo-tex class=\"arithmatex\">||(\\sum_{t = 0}^{4} x_{i, d+t, \\text{\u663c}} \\leq 4||)</marimo-tex> <marimo-tex class=\"arithmatex\">||((\\forall i, d)||)</marimo-tex></li>\n<li>\u591c\u52e4\u660e\u3051\u306e\u4f11\u65e5\u4ee5\u5916: <marimo-tex class=\"arithmatex\">||(\\sum_{s \\in W \\cap N} x_{i, d + 1, s} &lt;= 5 \\cdot (1 - x_{i, d, \\text{\u591c}})||)</marimo-tex></li>\n<li>\u5915\u306e\u76f4\u5f8c\u306e\u663c\u3042\u308b\u3044\u306f\u4f1a\u8b70: \u4f1a\u8b70\u304c\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u306e\u3067\u7701\u7565</li>\n<li>\u4f11\u65e5 <iconify-icon icon=\"lucide:arrow-right\" inline=\"\"></iconify-icon> \u52e4\u52d9 <iconify-icon icon=\"lucide:arrow-right\" inline=\"\"></iconify-icon> \u4f11\u65e5: <marimo-tex class=\"arithmatex\">||(x_{i, d-1, \\text{\u4f11}} + \\sum_{s \\in W} x_{i d s} + x_{i, d+1, \\text{\u4f11}} \\leq 2||)</marimo-tex></li>\n</ul>\n</li>\n<li>\u591c\u52e4\u306f 2 \u9023\u7d9a: <marimo-tex class=\"arithmatex\">||(\\sum_{s \\in N} x_{i,d-1,s} + x_{i,d,\\text{\u591c}} + \\sum_{s \\in N} x_{i,d+1,s} \\leq 2||)</marimo-tex></li>\n<li>2 \u30c1\u30fc\u30e0\u306e\u4eba\u6570\u3092\u3067\u304d\u308b\u3060\u3051\u5747\u7b49\u5316:\n  <marimo-tex class=\"arithmatex\">||(\\sum_{i \\in T_1} x_{i d s} = \\sum_{i \\in T_2} x_{i d s}||)</marimo-tex> <marimo-tex class=\"arithmatex\">||((\\forall d, s)||)</marimo-tex>. \u3053\u308c\u306f\u5236\u7d04\u3068\u3044\u3046\u3088\u308a\u306f\u76ee\u7684\u95a2\u6570?</li>\n</ul></span>"}, "type": "data"}]}, {"code_hash": "2fe46d19ca3a8f4c7efe355b92124f2c", "console": [], "id": "Xref", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><h2 id=\"or-tools-example\">OR-Tools Example</h2></span>"}, "type": "data"}]}, {"code_hash": "86530c6ada3b9f28d23cd3fd72eeba0d", "console": [], "id": "SFPL", "outputs": [{"data": {"text/html": "<span class=\"markdown prose dark:prose-invert\"><span class=\"paragraph\">\u53c2\u8003: <a href=\"https://github.com/google/or-tools/blob/stable/examples/notebook/sat/nurses_sat.ipynb\" rel=\"noopener\" target=\"_blank\">https://github.com/google/or-tools/blob/stable/examples/notebook/sat/nurses_sat.ipynb</a></span></span>"}, "type": "data"}]}, {"code_hash": "1342640c9daa61fdce56e59385afd202", "console": [], "id": "BYtC", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "ea87344604daeae899ffe0a9ce93ac65", "console": [], "id": "RGSE", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "5304ed72321b31dae0be83049cebbfa0", "console": [{"name": "stdout", "text": "Solution 1\nDay 0\n  Nurse 0 does not work\n  Nurse 1 works shift 2\n  Nurse 2 works shift 0\n  Nurse 3 works shift 1\nDay 1\n  Nurse 0 does not work\n  Nurse 1 works shift 1\n  Nurse 2 works shift 0\n  Nurse 3 works shift 2\nDay 2\n  Nurse 0 works shift 1\n  Nurse 1 works shift 2\n  Nurse 2 does not work\n  Nurse 3 works shift 0\nDay 3\n  Nurse 0 works shift 2\n  Nurse 1 does not work\n  Nurse 2 works shift 1\n  Nurse 3 works shift 0\nDay 4\n  Nurse 0 works shift 1\n  Nurse 1 works shift 2\n  Nurse 2 works shift 0\n  Nurse 3 does not work\nDay 5\n  Nurse 0 works shift 1\n  Nurse 1 works shift 2\n  Nurse 2 works shift 0\n  Nurse 3 does not work\nSolution 2\nDay 0\n  Nurse 0 works shift 2\n  Nurse 1 does not work\n  Nurse 2 works shift 0\n  Nurse 3 works shift 1\nDay 1\n  Nurse 0 does not work\n  Nurse 1 works shift 1\n  Nurse 2 works shift 0\n  Nurse 3 works shift 2\nDay 2\n  Nurse 0 works shift 1\n  Nurse 1 works shift 2\n  Nurse 2 does not work\n  Nurse 3 works shift 0\nDay 3\n  Nurse 0 works shift 2\n  Nurse 1 does not work\n  Nurse 2 works shift 1\n  Nurse 3 works shift 0\nDay 4\n  Nurse 0 works shift 1\n  Nurse 1 works shift 2\n  Nurse 2 works shift 0\n  Nurse 3 does not work\nDay 5\n  Nurse 0 works shift 1\n  Nurse 1 works shift 2\n  Nurse 2 works shift 0\n  Nurse 3 does not work\nSolution 3\nDay 0\n  Nurse 0 works shift 2\n  Nurse 1 does not work\n  Nurse 2 works shift 0\n  Nurse 3 works shift 1\nDay 1\n  Nurse 0 does not work\n  Nurse 1 works shift 1\n  Nurse 2 works shift 0\n  Nurse 3 works shift 2\nDay 2\n  Nurse 0 works shift 1\n  Nurse 1 works shift 2\n  Nurse 2 does not work\n  Nurse 3 works shift 0\nDay 3\n  Nurse 0 works shift 2\n  Nurse 1 does not work\n  Nurse 2 works shift 1\n  Nurse 3 works shift 0\nDay 4\n  Nurse 0 works shift 2\n  Nurse 1 works shift 1\n  Nurse 2 works shift 0\n  Nurse 3 does not work\nDay 5\n  Nurse 0 works shift 1\n  Nurse 1 works shift 2\n  Nurse 2 works shift 0\n  Nurse 3 does not work\nSolution 4\nDay 0\n  Nurse 0 does not work\n  Nurse 1 works shift 2\n  Nurse 2 works shift 0\n  Nurse 3 works shift 1\nDay 1\n  Nurse 0 does not work\n  Nurse 1 works shift 1\n  Nurse 2 works shift 0\n  Nurse 3 works shift 2\nDay 2\n  Nurse 0 works shift 1\n  Nurse 1 works shift 2\n  Nurse 2 does not work\n  Nurse 3 works shift 0\nDay 3\n  Nurse 0 works shift 2\n  Nurse 1 does not work\n  Nurse 2 works shift 1\n  Nurse 3 works shift 0\nDay 4\n  Nurse 0 works shift 2\n  Nurse 1 works shift 1\n  Nurse 2 works shift 0\n  Nurse 3 does not work\nDay 5\n  Nurse 0 works shift 1\n  Nurse 1 works shift 2\n  Nurse 2 works shift 0\n  Nurse 3 does not work\nSolution 5\nDay 0\n  Nurse 0 does not work\n  Nurse 1 works shift 2\n  Nurse 2 works shift 0\n  Nurse 3 works shift 1\nDay 1\n  Nurse 0 does not work\n  Nurse 1 works shift 1\n  Nurse 2 works shift 0\n  Nurse 3 works shift 2\nDay 2\n  Nurse 0 works shift 2\n  Nurse 1 works shift 1\n  Nurse 2 does not work\n  Nurse 3 works shift 0\nDay 3\n  Nurse 0 works shift 2\n  Nurse 1 does not work\n  Nurse 2 works shift 1\n  Nurse 3 works shift 0\nDay 4\n  Nurse 0 works shift 2\n  Nurse 1 works shift 1\n  Nurse 2 works shift 0\n  Nurse 3 does not work\nDay 5\n  Nurse 0 works shift 1\n  Nurse 1 works shift 2\n  Nurse 2 works shift 0\n  Nurse 3 does not work\nStop search after 5 solutions\n\nStatistics\n  - conflicts      : 6\n  - branches       : 448\n  - wall time      : 0.004282972 s\n  - solutions found: 5\n", "type": "stream"}], "id": "Kclp", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": null, "console": [], "id": "emfo", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}], "metadata": {"marimo_version": "0.14.7"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    import%20marimo%0A%0A__generated_with%20%3D%20%220.14.7%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20return%20(mo%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20from%20ortools.sat.python%20import%20cp_model%0A%20%20%20%20return%20(cp_model%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%23%20%E7%9C%8B%E8%AD%B7%E5%B8%AB%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0%E5%95%8F%E9%A1%8C%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%23%23%20%E5%95%8F%E9%A1%8C%E8%A8%AD%E5%AE%9A%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%E5%85%B8%E5%9E%8B%E7%9A%84%E3%81%AA%E8%A8%AD%E5%AE%9A%E3%81%A0%E3%81%A8%E4%B8%8B%E8%A8%98.%20%0A%0A%20%20%20%20-%20%E6%AF%8E%E6%97%A5%E3%81%AE%E5%90%84%E5%8B%A4%E5%8B%99%20(%E6%98%BC%2C%20%E5%A4%95%2C%20%E5%A4%9C)%20%E3%81%AE%E5%BF%85%E8%A6%81%E4%BA%BA%E6%95%B0%0A%20%20%20%20-%20%E5%90%84%E7%9C%8B%E8%AD%B7%E5%B8%AB%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%2030%20%E6%97%A5%E9%96%93%E3%81%AE%E5%8B%A4%E5%8B%99%E6%97%A5%E6%95%B0%E3%81%AE%E4%B8%8A%E4%B8%8B%E9%99%90%0A%20%20%20%20-%20%E6%8C%87%E5%AE%9A%E4%BC%91%E6%97%A5%2C%20%E6%8C%87%E5%AE%9A%E4%BC%9A%E8%AD%B0%E6%97%A5%0A%20%20%20%20-%20%E9%80%A3%E7%B6%9A%207%20%E6%97%A5%E9%96%93%E3%81%AB%E6%9C%80%E4%BD%8E%201%20%E6%97%A5%E3%81%AE%E4%BC%91%E6%97%A5%2C%20%E6%9C%80%E4%BD%8E%201%20%E6%97%A5%E3%81%AE%E6%98%BC%E5%8B%A4%E5%8B%99%0A%20%20%20%20-%20%E7%A6%81%E6%AD%A2%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%0A%20%20%20%20%20%20%20%20-%203%20%E9%80%A3%E7%B6%9A%E5%A4%9C%E5%8B%A4%0A%20%20%20%20%20%20%20%20-%204%20%E9%80%A3%E7%B6%9A%E5%A4%95%E5%8B%A4%0A%20%20%20%20%20%20%20%20-%205%20%E9%80%A3%E7%B6%9A%E6%98%BC%E5%8B%A4%0A%20%20%20%20%20%20%20%20-%20%E5%A4%9C%E5%8B%A4%E6%98%8E%E3%81%91%E3%81%AE%E4%BC%91%E6%97%A5%E4%BB%A5%E5%A4%96%0A%20%20%20%20%20%20%20%20-%20%E5%A4%95%E5%8B%A4%E3%81%AE%E7%9B%B4%E5%BE%8C%E3%81%AE%E6%98%BC%E5%8B%A4%E3%81%82%E3%82%8B%E3%81%84%E3%81%AF%E4%BC%9A%E8%AD%B0%0A%20%20%20%20%20%20%20%20-%20%E4%BC%91%E6%97%A5%20%3A%3Alucide%3Aarrow-right%3A%3A%20%E5%8B%A4%E5%8B%99%20%3A%3Alucide%3Aarrow-right%3A%3A%20%E4%BC%91%E6%97%A5%0A%20%20%20%20-%20%E5%A4%9C%E5%8B%A4%E3%81%AF%202%20%E5%9B%9E%E9%80%A3%E7%B6%9A%E3%81%A7%E8%A1%8C%E3%81%86%0A%20%20%20%20-%202%20%E3%81%A4%E3%81%AE%E3%83%81%E3%83%BC%E3%83%A0%E3%81%AE%E4%BA%BA%E6%95%B0%E3%82%92%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%A0%E3%81%91%E5%9D%87%E7%AD%89%E5%8C%96%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%23%20%E5%AE%9A%E6%95%B0%0A%0A%20%20%20%20-%20%24W%24%3A%20%E4%BC%91%E6%97%A5%E4%BB%A5%E5%A4%96%E3%81%AE%E3%82%B7%E3%83%95%E3%83%88%E3%81%AE%E9%9B%86%E5%90%88%0A%20%20%20%20-%20%24N%24%3A%20%E5%A4%9C%E5%8B%A4%E4%BB%A5%E5%A4%96%E3%81%AE%E3%82%B7%E3%83%95%E3%83%88%E3%81%AE%E9%9B%86%E5%90%88%0A%20%20%20%20-%20%24L_%7Bd%20s%7D%24%3A%20%E6%97%A5%20%24d%24%20%E3%81%AE%E3%82%B7%E3%83%95%E3%83%88%20%24s%24%20%E3%81%AE%E5%BF%85%E8%A6%81%E4%BA%BA%E6%95%B0%0A%20%20%20%20-%20%24%5Cmathrm%7BLB%7D%2C%20%5Cmathrm%7BUB%7D%24%3A%20%E5%90%84%E7%9C%8B%E8%AD%B7%E5%B8%AB%E3%81%AE%2030%20%E6%97%A5%E9%96%93%E3%81%AE%E5%8B%A4%E5%8B%99%E6%97%A5%E6%95%B0%E3%81%AE%E4%B8%8A%E4%B8%8B%E9%99%90%0A%20%20%20%20-%20%24R_i%24%3A%20%E7%9C%8B%E8%AD%B7%E5%B8%AB%20%24i%24%20%E3%81%8C%E4%BC%91%E6%97%A5%E3%82%92%E5%B8%8C%E6%9C%9B%E3%81%99%E3%82%8B%E6%97%A5%E3%81%AE%E9%9B%86%E5%90%88%0A%20%20%20%20-%20%24T_1%2C%20T_2%24%3A%20%E3%83%81%E3%83%BC%E3%83%A0%201%2C%20%E3%83%81%E3%83%BC%E3%83%A0%202.%0A%0A%20%20%20%20%23%23%23%20%E6%B1%BA%E5%AE%9A%E5%A4%89%E6%95%B0%0A%0A%20%20%20%20-%20%24x_%7Bi%20d%20s%7D%24%3A%20%E7%9C%8B%E8%AD%B7%E5%B8%AB%20%24i%24%20%E3%81%AE%20%24d%24%20%E6%97%A5%E3%81%AE%E5%8B%A4%E5%8B%99%E3%81%8C%20%24s%24%20%E3%81%A7%E3%81%82%E3%82%8B%E3%81%A8%E3%81%8D%20%241%24.%20%E3%81%9D%E3%81%86%E3%81%A7%E3%81%AA%E3%81%84%E3%81%A8%E3%81%8D%20%240%24%0A%0A%20%20%20%20%23%23%23%20%E5%88%B6%E7%B4%84%E6%9D%A1%E4%BB%B6%0A%0A%20%20%20%20-%20%E6%AF%8E%E6%97%A5%E3%81%AE%E5%90%84%E5%8B%A4%E5%8B%99%E3%81%AE%E5%BF%85%E8%A6%81%E4%BA%BA%E6%95%B0%3A%20%24%5Csum_%7Bi%7D%20x_%7Bi%20d%20s%7D%20%5Cgeq%20L_%7Bd%20s%7D%24%20%24(%5Cforall%20d%2C%20s)%24%0A%20%20%20%20-%20%E5%90%84%E7%9C%8B%E8%AD%B7%E5%B8%AB%E3%81%AE%2030%20%E6%97%A5%E9%96%93%E3%81%AE%E5%8B%A4%E5%8B%99%E6%97%A5%E6%95%B0%E3%81%AE%E4%B8%8A%E4%B8%8B%E9%99%90%3A%20%24%5Cmathrm%7BLB%7D%20%5Cleq%20%5Csum_%7Bd%2C%20s%20%5Cin%20W%7D%20x_%7Bi%20d%20s%7D%20%5Cleq%20%5Cmathrm%7BUB%7D%24%20%24(%5Cforall%20i)%24%0A%20%20%20%20-%20%E6%8C%87%E5%AE%9A%E4%BC%91%E6%97%A5%E3%83%BB%E6%8C%87%E5%AE%9A%E4%BC%9A%E8%AD%B0%E6%97%A5%3A%20%24%5Csum_%7Bd%20%5Cin%20R_i%2C%20s%20%5Cin%20W%7D%20x_%7Bi%20d%20s%7D%20%5Cleq%200%24%20%24(%5Cforall%20i)%24%0A%20%20%20%20-%20%E9%80%A3%E7%B6%9A%207%20%E6%97%A5%E9%96%93%E3%81%AB%E6%9C%80%E4%BD%8E%201%20%E6%97%A5%E3%81%AE%E4%BC%91%E6%97%A5%2C%20%E6%9C%80%E4%BD%8E%201%20%E6%97%A5%E3%81%AE%E6%98%BC%E5%8B%A4%3A%0A%20%20%20%20%20%20%20%20-%20%24%5Csum_%7Bt%20%3D%200%7D%5E%7B6%7D%20x_%7Bi%2C%20d%2Bt%2C%20%5Ctext%7B%E4%BC%91%7D%7D%20%5Cgeq%201%24%20%24(%5Cforall%20i%2C%20d)%24%0A%20%20%20%20%20%20%20%20-%20%24%5Csum_%7Bt%20%3D%200%7D%5E%7B6%7D%20x_%7Bi%2C%20d%2Bt%2C%20%5Ctext%7B%E6%98%BC%7D%7D%20%5Cgeq%201%24%20%24(%5Cforall%20i%2C%20d)%24%0A%20%20%20%20-%20%E7%A6%81%E6%AD%A2%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%0A%20%20%20%20%20%20%20%20-%203%20%E9%80%A3%E7%B6%9A%E5%A4%9C%E5%8B%A4%3A%20%24%5Csum_%7Bt%20%3D%200%7D%5E%7B2%7D%20x_%7Bi%2C%20d%2Bt%2C%20%5Ctext%7B%E5%A4%9C%7D%7D%20%5Cleq%202%24%20%24(%5Cforall%20i%2C%20d)%24%0A%20%20%20%20%20%20%20%20-%204%20%E9%80%A3%E7%B6%9A%E5%A4%95%E5%8B%A4%3A%20%24%5Csum_%7Bt%20%3D%200%7D%5E%7B3%7D%20x_%7Bi%2C%20d%2Bt%2C%20%5Ctext%7B%E5%A4%95%7D%7D%20%5Cleq%203%24%20%24(%5Cforall%20i%2C%20d)%24%0A%20%20%20%20%20%20%20%20-%205%20%E9%80%A3%E7%B6%9A%E6%98%BC%E5%8B%A4%3A%20%24%5Csum_%7Bt%20%3D%200%7D%5E%7B4%7D%20x_%7Bi%2C%20d%2Bt%2C%20%5Ctext%7B%E6%98%BC%7D%7D%20%5Cleq%204%24%20%24(%5Cforall%20i%2C%20d)%24%0A%20%20%20%20%20%20%20%20-%20%E5%A4%9C%E5%8B%A4%E6%98%8E%E3%81%91%E3%81%AE%E4%BC%91%E6%97%A5%E4%BB%A5%E5%A4%96%3A%20%24%5Csum_%7Bs%20%5Cin%20W%20%5Ccap%20N%7D%20x_%7Bi%2C%20d%20%2B%201%2C%20s%7D%20%3C%3D%205%20%5Ccdot%20(1%20-%20x_%7Bi%2C%20d%2C%20%5Ctext%7B%E5%A4%9C%7D%7D)%24%0A%20%20%20%20%20%20%20%20-%20%E5%A4%95%E3%81%AE%E7%9B%B4%E5%BE%8C%E3%81%AE%E6%98%BC%E3%81%82%E3%82%8B%E3%81%84%E3%81%AF%E4%BC%9A%E8%AD%B0%3A%20%E4%BC%9A%E8%AD%B0%E3%81%8C%E3%82%88%E3%81%8F%E3%82%8F%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84%E3%81%AE%E3%81%A7%E7%9C%81%E7%95%A5%0A%20%20%20%20%20%20%20%20-%20%E4%BC%91%E6%97%A5%20%3A%3Alucide%3Aarrow-right%3A%3A%20%E5%8B%A4%E5%8B%99%20%3A%3Alucide%3Aarrow-right%3A%3A%20%E4%BC%91%E6%97%A5%3A%20%24x_%7Bi%2C%20d-1%2C%20%5Ctext%7B%E4%BC%91%7D%7D%20%2B%20%5Csum_%7Bs%20%5Cin%20W%7D%20x_%7Bi%20d%20s%7D%20%2B%20x_%7Bi%2C%20d%2B1%2C%20%5Ctext%7B%E4%BC%91%7D%7D%20%5Cleq%202%24%0A%20%20%20%20-%20%E5%A4%9C%E5%8B%A4%E3%81%AF%202%20%E9%80%A3%E7%B6%9A%3A%20%24%5Csum_%7Bs%20%5Cin%20N%7D%20x_%7Bi%2Cd-1%2Cs%7D%20%2B%20x_%7Bi%2Cd%2C%5Ctext%7B%E5%A4%9C%7D%7D%20%2B%20%5Csum_%7Bs%20%5Cin%20N%7D%20x_%7Bi%2Cd%2B1%2Cs%7D%20%5Cleq%202%24%0A%20%20%20%20-%202%20%E3%83%81%E3%83%BC%E3%83%A0%E3%81%AE%E4%BA%BA%E6%95%B0%E3%82%92%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%A0%E3%81%91%E5%9D%87%E7%AD%89%E5%8C%96%3A%0A%20%20%20%20%20%20%24%5Csum_%7Bi%20%5Cin%20T_1%7D%20x_%7Bi%20d%20s%7D%20%3D%20%5Csum_%7Bi%20%5Cin%20T_2%7D%20x_%7Bi%20d%20s%7D%24%20%24(%5Cforall%20d%2C%20s)%24.%20%E3%81%93%E3%82%8C%E3%81%AF%E5%88%B6%E7%B4%84%E3%81%A8%E3%81%84%E3%81%86%E3%82%88%E3%82%8A%E3%81%AF%E7%9B%AE%E7%9A%84%E9%96%A2%E6%95%B0%3F%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%23%23%20OR-Tools%20Example%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%E5%8F%82%E8%80%83%3A%20https%3A%2F%2Fgithub.com%2Fgoogle%2For-tools%2Fblob%2Fstable%2Fexamples%2Fnotebook%2Fsat%2Fnurses_sat.ipynb%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(cp_model)%3A%0A%20%20%20%20class%20NursesPartialSolutionPrinter(cp_model.CpSolverSolutionCallback)%3A%0A%20%20%20%20%20%20%20%20%22%22%22Print%20intermediate%20solutions.%22%22%22%0A%0A%20%20%20%20%20%20%20%20def%20__init__(self%2C%20shifts%2C%20num_nurses%2C%20num_days%2C%20num_shifts%2C%20limit)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20cp_model.CpSolverSolutionCallback.__init__(self)%0A%20%20%20%20%20%20%20%20%20%20%20%20self._shifts%20%3D%20shifts%0A%20%20%20%20%20%20%20%20%20%20%20%20self._num_nurses%20%3D%20num_nurses%0A%20%20%20%20%20%20%20%20%20%20%20%20self._num_days%20%3D%20num_days%0A%20%20%20%20%20%20%20%20%20%20%20%20self._num_shifts%20%3D%20num_shifts%0A%20%20%20%20%20%20%20%20%20%20%20%20self._solution_count%20%3D%200%0A%20%20%20%20%20%20%20%20%20%20%20%20self._solution_limit%20%3D%20limit%0A%0A%20%20%20%20%20%20%20%20def%20on_solution_callback(self)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20self._solution_count%20%2B%3D%201%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Solution%20%7Bself._solution_count%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20d%20in%20range(self._num_days)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Day%20%7Bd%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20n%20in%20range(self._num_nurses)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20is_working%20%3D%20False%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20s%20in%20range(self._num_shifts)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20self.value(self._shifts%5B(n%2C%20d%2C%20s)%5D)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20is_working%20%3D%20True%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20Nurse%20%7Bn%7D%20works%20shift%20%7Bs%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20not%20is_working%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20Nurse%20%7Bn%7D%20does%20not%20work%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20self._solution_count%20%3E%3D%20self._solution_limit%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Stop%20search%20after%20%7Bself._solution_limit%7D%20solutions%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.stop_search()%0A%0A%20%20%20%20%20%20%20%20def%20solutionCount(self)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20self._solution_count%0A%20%20%20%20return%20(NursesPartialSolutionPrinter%2C)%0A%0A%0A%40app.cell%0Adef%20_(NursesPartialSolutionPrinter%2C%20cp_model)%3A%0A%20%20%20%20class%20Model%3A%0A%20%20%20%20%20%20%20%20def%20__init__(self%2C%20num_nurses%3A%20int%2C%20num_shifts%3A%20int%2C%20num_days%3A%20int)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20all_nurses%20%3D%20range(num_nurses)%0A%20%20%20%20%20%20%20%20%20%20%20%20all_shifts%20%3D%20range(num_shifts)%0A%20%20%20%20%20%20%20%20%20%20%20%20all_days%20%3D%20range(num_days)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20model%20%3D%20cp_model.CpModel()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20shifts%5B(n%2C%20d%2C%20s)%5D%3A%20nurse%20'n'%20works%20shift%20's'%20on%20day%20'd'.%0A%20%20%20%20%20%20%20%20%20%20%20%20shifts%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(_n%2C%20_d%2C%20_s)%3A%20model.new_bool_var(f%22shift_n%7B_n%7D_d%7B_d%7D_s%7B_s%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20_n%20in%20all_nurses%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20_d%20in%20all_days%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20_s%20in%20all_shifts%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Each%20shift%20is%20assigned%20to%20exactly%20one%20nurse%20in%20the%20schedule%20period.%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20_d%20in%20all_days%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20_s%20in%20all_shifts%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model.add_exactly_one(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20shifts%5B(_n%2C%20_d%2C%20_s)%5D%20for%20_n%20in%20all_nurses%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Each%20nurse%20works%20at%20most%20one%20shift%20per%20day.%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20_n%20in%20all_nurses%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20_d%20in%20all_days%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model.add_at_most_one(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20shifts%5B(_n%2C%20_d%2C%20_s)%5D%20for%20_s%20in%20all_shifts%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Try%20to%20distribute%20the%20shifts%20evenly%2C%20so%20that%20each%20nurse%20works%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20min_shifts_per_nurse%20shifts.%20If%20this%20is%20not%20possible%2C%20because%20the%20total%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20number%20of%20shifts%20is%20not%20divisible%20by%20the%20number%20of%20nurses%2C%20some%20nurses%20will%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20be%20assigned%20one%20more%20shift.%0A%20%20%20%20%20%20%20%20%20%20%20%20min_shifts_per_nurse%20%3D%20(num_shifts%20*%20num_days)%20%2F%2F%20num_nurses%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20num_shifts%20*%20num_days%20%25%20num_nurses%20%3D%3D%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20max_shifts_per_nurse%20%3D%20min_shifts_per_nurse%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20max_shifts_per_nurse%20%3D%20min_shifts_per_nurse%20%2B%201%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20_n%20in%20all_nurses%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20shifts_worked%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20_d%20in%20all_days%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20_s%20in%20all_shifts%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20shifts_worked.append(shifts%5B(_n%2C%20_d%2C%20_s)%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model.add(min_shifts_per_nurse%20%3C%3D%20sum(shifts_worked))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model.add(sum(shifts_worked)%20%3C%3D%20max_shifts_per_nurse)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E8%BF%BD%E5%8A%A0%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20shift%200%20%E3%82%92%E5%A4%9C%E5%8B%A4%E3%81%A8%E3%81%97%E3%81%A6%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20-%20%E5%A4%9C%E5%8B%A4%E3%81%AF%202%20%E9%80%A3%E7%B6%9A%E3%81%97%E3%81%AA%E3%81%91%E3%82%8C%E3%81%B0%E3%81%AA%E3%82%89%E3%81%AA%E3%81%84%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20-%20%E5%A4%9C%E5%8B%A4%E3%81%AF%203%20%E9%80%A3%E7%B6%9A%E3%81%97%E3%81%A6%E3%81%AF%E3%81%84%E3%81%91%E3%81%AA%E3%81%84%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E3%81%9F%E3%81%A0%E3%81%93%E3%82%8C%E3%81%A0%E3%81%A8%E5%A4%9C%E5%8B%A4%E3%81%8C%E5%81%8F%E3%81%A3%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86%E3%81%AE%E3%81%A7%E8%BF%BD%E5%8A%A0%E3%81%AE%E5%88%B6%E7%B4%84%E3%81%8C%E5%BF%85%E8%A6%81%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20_n%20in%20all_nurses%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model.add_implication(shifts%5B(_n%2C%200%2C%200)%5D%2C%20shifts%5B(_n%2C%201%2C%200)%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20_d%20in%20all_days%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20_d%20%3D%3D%200%20or%20_d%20%3D%3D%20num_days%20-%201%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model.add_implication(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20shifts%5B(_n%2C%20_d%2C%200)%5D%2C%20shifts%5B(_n%2C%20_d%20%2B%201%2C%200)%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20).only_enforce_if(~shifts%5B(_n%2C%20_d%20-%201%2C%200)%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20model.add_bool_or(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5B~shifts%5B(_n%2C%20_d%20%2B%20_t%2C%200)%5D%20for%20_t%20in%20%5B-1%2C%200%2C%201%5D%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.num_nurses%20%3D%20num_nurses%0A%20%20%20%20%20%20%20%20%20%20%20%20self.num_shifts%20%3D%20num_shifts%0A%20%20%20%20%20%20%20%20%20%20%20%20self.num_days%20%3D%20num_days%0A%20%20%20%20%20%20%20%20%20%20%20%20self.cpmodel%20%3D%20model%0A%20%20%20%20%20%20%20%20%20%20%20%20self.shifts%20%3D%20shifts%0A%0A%20%20%20%20%20%20%20%20def%20solve(self)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20solver%20%3D%20cp_model.CpSolver()%0A%20%20%20%20%20%20%20%20%20%20%20%20solver.parameters.linearization_level%20%3D%200%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Enumerate%20all%20solutions.%0A%20%20%20%20%20%20%20%20%20%20%20%20solver.parameters.enumerate_all_solutions%20%3D%20True%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20solution_limit%20%3D%205%0A%20%20%20%20%20%20%20%20%20%20%20%20solution_printer%20%3D%20NursesPartialSolutionPrinter(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.shifts%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.num_nurses%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.num_days%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.num_shifts%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20solution_limit%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20solver.solve(self.cpmodel%2C%20solution_printer)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Statistics.%0A%20%20%20%20%20%20%20%20%20%20%20%20print(%22%5CnStatistics%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20-%20conflicts%20%20%20%20%20%20%3A%20%7Bsolver.num_conflicts%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20-%20branches%20%20%20%20%20%20%20%3A%20%7Bsolver.num_branches%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20-%20wall%20time%20%20%20%20%20%20%3A%20%7Bsolver.wall_time%7D%20s%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%20%20-%20solutions%20found%3A%20%7Bsolution_printer.solutionCount()%7D%22)%0A%20%20%20%20return%20(Model%2C)%0A%0A%0A%40app.cell%0Adef%20_(Model)%3A%0A%20%20%20%20model%20%3D%20Model(num_nurses%3D4%2C%20num_shifts%3D3%2C%20num_days%3D6)%0A%20%20%20%20model.solve()%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">f9699490428f424c42bb9177d06da95b915b1b9e2fcca25a19feca00f4f7384d</marimo-code-hash>
</body>
</html>
